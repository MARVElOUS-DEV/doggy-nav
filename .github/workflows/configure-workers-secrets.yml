name: Configure Worker Secrets (Manual)

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment'
        type: choice
        required: true
        options:
          - production
          - staging
          - preview
        default: production

jobs:
  configure:
    environment: ${{ inputs.environment }}
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: pnpm/action-setup@v3
        with:
          version: 9

      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Set Worker secrets (skips if a secret is missing)
        working-directory: packages/doggy-nav-workers
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CF_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CF_ACCOUNT_ID }}
          JWT_SECRET: ${{ secrets.JWT_SECRET }}
          SEED_TOKEN: ${{ secrets.SEED_TOKEN }}
          GITHUB_CLIENT_SECRET: ${{ secrets.GITHUB_CLIENT_SECRET }}
          GOOGLE_CLIENT_SECRET: ${{ secrets.GOOGLE_CLIENT_SECRET }}
          LINUXDO_CLIENT_SECRET: ${{ secrets.LINUXDO_CLIENT_SECRET }}
        run: |
          set -euo pipefail
          if [ -n "${JWT_SECRET:-}" ]; then echo "$JWT_SECRET" | pnpm dlx wrangler@^4.46.0 secret put JWT_SECRET; else echo "JWT_SECRET not set; skipping"; fi
          if [ -n "${SEED_TOKEN:-}" ]; then echo "$SEED_TOKEN" | pnpm dlx wrangler@^4.46.0 secret put SEED_TOKEN; else echo "SEED_TOKEN not set; skipping"; fi
          if [ -n "${GITHUB_CLIENT_SECRET:-}" ]; then echo "$GITHUB_CLIENT_SECRET" | pnpm dlx wrangler@^4.46.0 secret put GITHUB_CLIENT_SECRET; else echo "GITHUB_CLIENT_SECRET not set; skipping"; fi
          if [ -n "${GOOGLE_CLIENT_SECRET:-}" ]; then echo "$GOOGLE_CLIENT_SECRET" | pnpm dlx wrangler@^4.46.0 secret put GOOGLE_CLIENT_SECRET; else echo "GOOGLE_CLIENT_SECRET not set; skipping"; fi
          if [ -n "${LINUXDO_CLIENT_SECRET:-}" ]; then echo "$LINUXDO_CLIENT_SECRET" | pnpm dlx wrangler@^4.46.0 secret put LINUXDO_CLIENT_SECRET; else echo "LINUXDO_CLIENT_SECRET not set; skipping"; fi

      # Intentionally no non-secret vars here; secrets-only workflow
